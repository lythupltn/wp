{"version":3,"sources":["builder-control.js"],"names":["r","e","n","t","o","i","f","c","require","u","a","Error","code","p","exports","call","length","1","module","obj","_view","_view2","__esModule","default","api","previewerIframe","builderControls","bind","previewer","previewData","send","_lwwbConfig","$","get","contentWindow","section","expand","el","radioChannel","lwwb","Radio","channel","render","current_page","elmn_picker","elmn","global_setting","setupBuilder","setupCurrentPageControl","setupElmnPickerControl","setupActiveControl","groupControl","control","container","find","trigger","on","event","currentTarget","val","activeGroupControls","unActiveControls","_","clone","each","controls","group","deactiveGroupControls","index","active","groupControls","Setting","extend","settingID","page","id","_setting","transport","dirty","add","elmnBuilderControl","push","dataBuilder","_configData","header","footer","content","set","JSON","stringify","headerSettingID","footerSettingID","hooksID","headerSetting","footerSetting","hooksSetting","wp","customize","isActiveCurrentPageControl","Control","label","type","setting","priority","choices","_lwwb_tmplCustomize","indexOf","hooks","multi","controlHooks","controlConstructor","settings","value","prop","config","elmnGroups","key","./view.new","2","_defineProperty","Object","defineProperty","enumerable","configurable","writable","templateSettings","evaluate","interpolate","escape","ElmnControlBehavior","Marionette","Behavior","onRender","self","this","view","$el","first","show","preventDefault","stopPropagation","searchData","trim","toLowerCase","foundControl","not","hide","parents","focus","ElmnControlView","View","template","regions","listControl","replaceElement","behaviors","modelEvents","change:elmn_data:contenteditable","change:elmn_data:field","childViewTriggers","list:control:update:data","initialize","elmnType","model","elmnData","elmns","elmnControls","parse","controlArr","map","ctr","fields","field","controlData","data","k","collection","Backbone","Collection","renderEditableContent","dataKey","getRegion","currentView","children","_views","found","updateElmnDataAndOptions","options","option","triggerMethod","replace","input_attrs","unit","listControlView","Mn","Views","showChildView","onChildListControlUpdateData","childView","BuilderControlView","cacheElmn","elmnRegion","listenTo","elmnModel","activeApiControl","showElmnView","expanded","maybeShowCache","elmnControlView","detachView","mcid","cid","cacheView","cv"],"mappings":"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","file":"builder-control.min.js","sourcesContent":["(function(){function r(e,n,t){function o(i,f){if(!n[i]){if(!e[i]){var c=\"function\"==typeof require&&require;if(!f&&c)return c(i,!0);if(u)return u(i,!0);var a=new Error(\"Cannot find module '\"+i+\"'\");throw a.code=\"MODULE_NOT_FOUND\",a}var p=n[i]={exports:{}};e[i][0].call(p.exports,function(r){var n=e[i][1][r];return o(n||r)},p,p.exports,r,e,n,t)}return n[i].exports}for(var u=\"function\"==typeof require&&require,i=0;i<t.length;i++)o(t[i]);return o}return r})()({1:[function(require,module,exports){\n\"use strict\";\n\nvar _view = require(\"./view.new\");\n\nvar _view2 = _interopRequireDefault(_view);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\n(function (api) {\n  var previewerIframe = void 0,\n      builderControls = void 0;\n  api.bind('ready', function () {\n    api.previewer.bind('ready', function (previewData) {\n      api.previewer.send('lwwb_config', _lwwbConfig);\n      previewerIframe = $('#customize-preview iframe').get($('#customize-preview iframe').length - 1).contentWindow;\n      api.section('lwwb_section').expand(true);\n      var builderView = new _view2.default({\n        el: '#lwwb-control-container',\n        radioChannel: previewerIframe.lwwb.Radio.channel\n      });\n      builderView.render();\n    });\n    builderControls = {\n      current_page: [],\n      elmn_picker: [],\n      elmn: [],\n      global_setting: []\n    };\n    api.previewer.bind('preview_data', function (previewData) {\n      setupBuilder(previewData);\n      setupCurrentPageControl(previewData);\n      setupElmnPickerControl(previewData);\n    });\n    setupActiveControl();\n    api.previewer.bind('active_group_control', function (groupControl) {\n      api.control('setting_switcher').container.find('.lwwb-input[value=\"' + groupControl + '\"]').trigger('click');\n    });\n  });\n\n  var setupActiveControl = function setupActiveControl() {\n    api.control('setting_switcher').container.on('click', '.lwwb-input', function (event) {\n      var groupControl = $(event.currentTarget).val();\n      activeGroupControls(groupControl);\n    });\n  };\n\n  var activeGroupControls = function activeGroupControls(groupControl) {\n    var unActiveControls = _.clone(builderControls);\n\n    delete unActiveControls[groupControl];\n\n    _.each(unActiveControls, function (controls, group) {\n      deactiveGroupControls(controls);\n    });\n\n    _.each(builderControls[groupControl], function (control, index) {\n      if (control.active()) {\n        return;\n      }\n\n      control.active(true);\n    });\n  };\n\n  var deactiveGroupControls = function deactiveGroupControls(groupControls) {\n    _.each(groupControls, function (control) {\n      control.active(false);\n    });\n  };\n\n  var setupBuilder = function setupBuilder(previewData) {\n    var Setting = api.Setting.extend({});\n    var settingID = 'lwwb_data[' + previewData.page.id + '][data]';\n\n    var _setting = api(settingID);\n\n    if (!_setting) {\n      var data = void 0;\n      _setting = new Setting(settingID, data, {\n        transport: 'postMessage',\n        previewer: api.previewer,\n        dirty: true\n      });\n      api.add(settingID, _setting);\n    }\n\n    var elmnBuilderControl = api.control('lwwb_build_panel');\n\n    if (elmnBuilderControl && !builderControls.elmn.length) {\n      builderControls.elmn.push(elmnBuilderControl);\n    }\n\n    api.previewer.bind('collection_data' + previewData.page.id, function (dataBuilder) {\n      var _configData = {\n        header: previewData.header.id,\n        footer: previewData.footer.id,\n        content: dataBuilder\n      };\n\n      _setting.set(JSON.stringify(_configData));\n    });\n  };\n\n  var setupCurrentPageControl = function setupCurrentPageControl(previewData) {\n    var Setting = api.Setting.extend({});\n    var headerSettingID = 'lwwb_data[' + previewData.page.id + '][header]';\n    var footerSettingID = 'lwwb_data[' + previewData.page.id + '][footer]';\n    var hooksID = 'lwwb_data[' + previewData.page.id + '][hooks]';\n    var headerSetting = api(headerSettingID);\n    var footerSetting = api(footerSettingID);\n    var hooksSetting = api(hooksID); // Header Settings\n\n    if (!headerSetting) {\n      headerSetting = new Setting(headerSettingID, previewData.header.id, {\n        transport: 'refresh',\n        default: '',\n        previewer: wp.customize.previewer\n      });\n      api.add(headerSettingID, headerSetting);\n    } else {}\n\n    if (!api.control(headerSettingID)) {\n      var control = new api.Control(headerSettingID, {\n        section: 'lwwb_section',\n        label: 'Header Config',\n        type: 'select',\n        setting: headerSettingID,\n        priority: 12,\n        // choices: pageHeaderId\n        choices: _lwwb_tmplCustomize.header,\n        active: false\n      });\n      api.control.add(control);\n\n      if (_.indexOf(builderControls.current_page, control) == -1) {\n        builderControls.current_page.push(control);\n      }\n    } else {\n      if (isActiveCurrentPageControl()) {\n        api.control(headerSettingID).active(true);\n      }\n    } // Footer Settings\n\n\n    if (!footerSetting) {\n      footerSetting = new Setting(footerSettingID, previewData.footer.id, {\n        transport: 'refresh',\n        default: '',\n        previewer: api.previewer\n      });\n      api.add(footerSettingID, footerSetting);\n    } else {}\n\n    if (!api.control(footerSettingID)) {\n      var control = new api.Control(footerSettingID, {\n        section: 'lwwb_section',\n        label: 'Footer Config',\n        type: 'select',\n        setting: footerSettingID,\n        priority: 12,\n        choices: _lwwb_tmplCustomize.footer,\n        active: false\n      });\n      api.control.add(control);\n\n      if (_.indexOf(builderControls.current_page, control) == -1) {\n        builderControls.current_page.push(control);\n      }\n    } else {\n      if (isActiveCurrentPageControl()) {\n        api.control(footerSettingID).active(true);\n      }\n    } // Builder Hooks\n\n\n    if (!hooksSetting) {\n      hooksSetting = new Setting(hooksID, previewData.hooks, {\n        transport: 'refresh',\n        default: previewData.hooks,\n        multi: true,\n        previewer: api.previewer\n      });\n      api.add(hooksID, hooksSetting);\n    } else {}\n\n    if (!api.control(hooksID)) {\n      var controlHooks = new api.controlConstructor['lwwb-checkbox'](hooksID, {\n        section: 'lwwb_section',\n        label: 'Hide Hooks Builder',\n        type: 'lwwb-checkbox',\n        settings: {\n          'default': hooksID\n        },\n        value: previewData.hooks,\n        priority: 12,\n        choices: _lwwb_tmplCustomize.hooks,\n        active: false\n      });\n      api.control.add(controlHooks);\n\n      if (_.indexOf(builderControls.current_page, controlHooks) == -1) {\n        builderControls.current_page.push(controlHooks);\n      }\n    } else {\n      if (isActiveCurrentPageControl()) {\n        api.control(hooksID).active(true);\n      }\n    }\n  };\n\n  var isActiveCurrentPageControl = function isActiveCurrentPageControl() {\n    var currentPageCheck = api.control('setting_switcher').container.find('.lwwb-input[value=\"current_page\"]');\n    return currentPageCheck.prop(\"checked\");\n  };\n\n  var setupElmnPickerControl = function setupElmnPickerControl(previewData) {\n    if (isActiveCurrentPageControl()) {\n      deactiveGroupControls(builderControls.elmn_picker);\n      return;\n    }\n\n    if (builderControls.elmn_picker.length) {\n      return;\n    }\n\n    _.each(previewData.config.elmnGroups, function (val, key) {\n      if (api.control(key)) {\n        builderControls.elmn_picker.push(api.control(key));\n      }\n\n      ;\n    });\n  };\n})(wp.customize);\n\n},{\"./view.new\":2}],2:[function(require,module,exports){\n\"use strict\";\n\nfunction _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }\n\nvar templateSettings = {\n  evaluate: /<#([\\s\\S]+?)#>/g,\n  interpolate: /\\{\\{\\{([\\s\\S]+?)\\}\\}\\}/g,\n  escape: /\\{\\{([^\\}]+?)\\}\\}(?!\\})/g\n};\nvar ElmnControlBehavior = Marionette.Behavior.extend({\n  onRender: function onRender() {\n    var self = this;\n    this.view.$el.find('.customize-control-group').first().show();\n    this.view.$el.find('.widget-inside').first().show();\n    this.view.$el.find('input#lwwb_search_control').on('keyup search change', function (event) {\n      event.preventDefault();\n      event.stopPropagation();\n      var searchData = $(this).val().trim().toLowerCase();\n\n      if (searchData) {\n        var foundControl = self.view.$el.find('.lwwb-control-container[data-keywords*=\"' + searchData + '\"]');\n        self.view.$el.find('.lwwb-control-container').not('#customize-control-lwwb-text-lwwb_search_control').hide();\n        self.view.$el.find('.customize-control-group').hide();\n        foundControl.show();\n        foundControl.parents('.customize-control-group').show();\n        foundControl.parents('.widget-inside').show();\n      } else {\n        self.view.$el.find('.lwwb-control-container').show();\n        self.view.render();\n        self.view.$el.find('input#lwwb_search_control').focus();\n      }\n    });\n  }\n});\nvar ElmnControlView = Marionette.View.extend({\n  template: _.template('<div class=\"lwwb-control-container\"></div>', templateSettings),\n  regions: {\n    listControl: {\n      el: '.lwwb-control-container',\n      replaceElement: true\n    }\n  },\n  behaviors: [ElmnControlBehavior],\n  modelEvents: {\n    'change:elmn_data:contenteditable': 'renderEditableContent',\n    'change:elmn_data:field': 'updateElmnDataAndOptions'\n  },\n  childViewTriggers: {\n    'list:control:update:data': 'child:list:control:update:data'\n  },\n  initialize: function initialize() {\n    var elmnType = this.model.get('elmn_type');\n    var elmnData = this.model.get('elmn_data');\n\n    if (!_lwwbConfig.elmns[elmnType]) {\n      return;\n    }\n\n    var elmnControls = JSON.parse(JSON.stringify(_lwwbConfig.elmns[elmnType].controls));\n\n    var controlArr = _.map(elmnControls, function (ctr) {\n      if ('lwwb-group' === ctr.type || 'lwwb-repeater' === ctr.type) {\n        _.map(ctr.fields, function (field) {\n          var controlData = void 0;\n\n          _.each(elmnData, function (data, key) {\n            if (key === field.id) {\n              controlData = _defineProperty({}, key, data);\n            }\n          });\n\n          if (controlData) {\n            field['value'] = controlData[field.id];\n          } else {\n            field['value'] = field['default'];\n          }\n\n          if (field['fields']) {\n            _.each(field['value'], function (value, id) {\n              var f = _.find(field['fields'], function (f, k) {\n                return f.id === id;\n              });\n\n              if (f) {\n                f['value'] = value;\n              }\n            });\n          }\n\n          return field;\n        });\n      }\n\n      var controlData = void 0;\n\n      _.each(elmnData, function (data, key) {\n        if (key === ctr.id) {\n          controlData = _defineProperty({}, key, data);\n        }\n      });\n\n      if (controlData) {\n        ctr['value'] = controlData[ctr.id];\n      } else {\n        ctr['value'] = ctr['default'];\n      }\n\n      return ctr;\n    });\n\n    this.collection = new Backbone.Collection(controlArr);\n  },\n  renderEditableContent: function renderEditableContent(dataKey, content) {\n    _.each(this.getRegion('listControl').currentView.children._views, function (view) {\n      if (view.getRegion('controlRegion')) {\n        var found = _.find(view.getRegion('controlRegion').currentView.children._views, function (view) {\n          return view.model.get('id') === dataKey;\n        });\n\n        if (found) {\n          found.model.set('value', content);\n          found.render();\n        }\n      }\n    });\n  },\n  updateElmnDataAndOptions: function updateElmnDataAndOptions(dataKey, data, options) {\n    _.each(this.getRegion('listControl').currentView.children._views, function (view) {\n      if (view.getRegion('controlRegion')) {\n        var found = _.find(view.getRegion('controlRegion').currentView.children._views, function (view) {\n          return view.model.get('id') === dataKey;\n        });\n\n        if (found) {\n          found.model.set('value', data).trigger('change:value');\n\n          if (options) {\n            _.each(options, function (option, key) {\n              found.triggerMethod('update:option:' + key.replace(/-/g, ':').replace(/_/g, ':'), option);\n            });\n          }\n\n          if (options && options.input_attrs) {\n            found.model.set('input_attrs', options.input_attrs);\n          }\n\n          if (options && options.unit) {\n            found.model.set('unit', options.unit);\n          }\n\n          found.render();\n        }\n      }\n    });\n  },\n  onRender: function onRender() {\n    var listControlView = new lwwb.Control.Mn.Views['control-collection']({\n      collection: this.collection\n    });\n    this.showChildView('listControl', listControlView);\n  },\n  onChildListControlUpdateData: function onChildListControlUpdateData(childView, data) {\n    var dataKey = childView.model.get('id');\n    var elmnData = this.model.get('elmn_data');\n    this.model.set('elmn_data', _.extend(elmnData, _defineProperty({}, dataKey, data)));\n    this.model.trigger('change:elmn_data', dataKey, data, childView);\n  }\n});\nvar BuilderControlView = Marionette.View.extend({\n  initialize: function initialize(options) {\n    this.radioChannel = options.radioChannel;\n    this.cacheElmn = [];\n  },\n  template: _.template('<div class=\"lwwb-control-container\"></div>', templateSettings),\n  regions: {\n    elmnRegion: {\n      el: '.lwwb-control-container',\n      replaceElement: true\n    }\n  },\n  onRender: function onRender() {\n    var self = this;\n    this.listenTo(this.radioChannel, 'active:elmn:control', function (elmnModel) {\n      self.activeApiControl();\n      self.showElmnView(elmnModel);\n    });\n  },\n  activeApiControl: function activeApiControl() {\n    if (!wp.customize.section('lwwb_section').expanded()) {\n      wp.customize.section('lwwb_section').expanded(true);\n    }\n\n    if (!wp.customize.control('lwwb_build_panel').active()) {\n      wp.customize.control('lwwb_build_panel').active(true);\n    }\n\n    wp.customize.control('setting_switcher').container.find('input[value=\"elmn\"]').trigger('click');\n  },\n  showElmnView: function showElmnView(elmnModel) {\n    var self = this;\n\n    if (!self.maybeShowCache(elmnModel)) {\n      var elmnControlView = new ElmnControlView({\n        model: elmnModel\n      });\n      self.getRegion('elmnRegion').detachView();\n      self.showChildView('elmnRegion', elmnControlView);\n      self.cacheElmn.push({\n        mcid: elmnModel.cid,\n        elmn: elmnModel,\n        view: elmnControlView\n      });\n    }\n  },\n  maybeShowCache: function maybeShowCache(elmnModel) {\n    var self = this;\n\n    var cacheView = _.find(self.cacheElmn, function (cv) {\n      return cv.mcid === elmnModel.cid;\n    });\n\n    if (cacheView) {\n      var elmnRegion = self.getRegion('elmnRegion');\n\n      if (elmnRegion.currentView) {\n        if (elmnRegion.currentView.model.cid === cacheView.mcid) {\n          return true;\n        }\n      }\n\n      if (cacheView.view.$el.find('.lwwb-control-lwwb-wysiwyg').length) {\n        return false;\n      }\n\n      self.getRegion('elmnRegion').detachView();\n      self.showChildView('elmnRegion', cacheView.view);\n      return true;\n    } else {\n      return false;\n    }\n  }\n});\nmodule.exports = BuilderControlView;\n\n},{}]},{},[1]);\n"]}